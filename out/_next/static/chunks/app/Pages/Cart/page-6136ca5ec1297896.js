(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{3432:(t,e,r)=>{Promise.resolve().then(r.bind(r,6661))},3411:(t,e,r)=>{"use strict";r.d(e,{dT:()=>n,pj:()=>o,zY:()=>i});var a=r(9632);async function o(t){let{userId:e,productId:r,quantity:o}=t;try{if(!await a.A.user.findUnique({where:{id:e}}))throw Error("User not found");if(!await a.A.product.findUnique({where:{id:r}}))throw Error("Product not found");let t=await a.A.cart.findUnique({where:{userId:e}});t||(t=await a.A.cart.create({data:{userId:e}}));let i=await a.A.cartItem.findFirst({where:{cartId:t.id,productId:r}});i?await a.A.cartItem.update({where:{id:i.id},data:{quantity:i.quantity+o}}):await a.A.cartItem.create({data:{cartId:t.id,productId:r,quantity:o}})}catch(t){throw console.error("Error adding to cart:",t),Error("Failed to add to cart")}}async function i(t,e){try{if(console.log("RemoveFromCart called with userId:",t,"and productId:",e),!await a.A.product.findUnique({where:{id:e}}))throw Error("Product not found");let r=await a.A.cart.findUnique({where:{userId:t}});if(!r)throw Error("Cart not found");await a.A.cartItem.deleteMany({where:{cartId:r.id,productId:e}}),console.log("Product removed successfully from cart")}catch(t){throw console.error("Error removing from cart:",t),Error("Failed to remove from cart")}}async function n(t){return(await a.A.cartItem.findMany({where:{cart:{userId:t}},include:{product:!0}})).map(t=>({id:t.id,productId:t.productId,quantity:t.quantity,price:t.product.price,product:{name:t.product.name}}))}},7582:(t,e,r)=>{"use strict";function a(t){try{localStorage.setItem("session",JSON.stringify(t))}catch(t){console.error("Error setting session:",t)}}function o(){try{let t=localStorage.getItem("session");return t?JSON.parse(t):null}catch(t){console.error("Error getting session:",t)}return null}function i(){try{localStorage.removeItem("session")}catch(t){console.error("Error clearing session:",t)}}r.d(e,{Ht:()=>o,Nq:()=>a,q7:()=>i})},6661:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var a=r(5155),o=r(7582),i=r(3411),n=r(2115);function d(){let[t,e]=(0,n.useState)(null),[r,d]=(0,n.useState)([]),[s,c]=(0,n.useState)(0);return(0,n.useEffect)(()=>{(async()=>{let t=await (0,o.Ht)();if(console.log("Session data:",t),e(t),t){let e=await (0,i.dT)(t.UserId);d(e),c(e.reduce((t,e)=>t+e.price*e.quantity,0))}})()},[]),(0,a.jsxs)("div",{className:"flex justify-center p-4 ",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md text-center w-full max-w-2xl font-bold text-2xl",children:[(0,a.jsxs)("h1",{children:["Cart of ",null==t?void 0:t.name]}),r.length>0?r.map(e=>(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[(0,a.jsxs)("p",{children:[e.product.name," - ",e.quantity," x ",e.price.toFixed(2)," zl"]}),(0,a.jsx)("button",{className:"bg-red-700 text-white px-4 py-2 rounded hover:bg-red-800 transition duration-300",onClick:async()=>{if(null==t?void 0:t.UserId){console.log("Removing item with id:",e.id),await (0,i.zY)(t.UserId,e.id);let r=await (0,i.dT)(t.UserId);d(r),c(r.reduce((t,e)=>t+e.price*e.quantity,0))}},children:"delete"})]},e.id)):(0,a.jsx)("p",{className:"mt-10",children:"No items in cart"})]}),(0,a.jsxs)("div",{className:"ml-4 h-1/4 max-w-2xl text-right bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsxs)("p",{className:"text-xl font-semibold",children:["Total Price: ",s.toFixed(2)," zÅ‚"]}),(0,a.jsx)("button",{className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300",children:"Proceed to Checkout"})]})]})}},9632:(t,e,r)=>{"use strict";throw r.d(e,{A:()=>__WEBPACK_DEFAULT_EXPORT__}),Error("PrismaClient is unable to run in the browser.")}},t=>{var e=e=>t(t.s=e);t.O(0,[441,517,358],()=>e(3432)),_N_E=t.O()}]);