(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{3432:(e,t,r)=>{Promise.resolve().then(r.bind(r,6661))},3411:(e,t,r)=>{"use strict";r.d(t,{dT:()=>d,pj:()=>i,zY:()=>o});var a=r(9632);async function i(e){let{userId:t,productId:r,quantity:i}=e;try{if(!await a.z.user.findUnique({where:{id:t}}))throw Error("User not found");if(!await a.z.product.findUnique({where:{id:r}}))throw Error("Product not found");let e=await a.z.cart.findUnique({where:{userId:t}});e||(e=await a.z.cart.create({data:{userId:t}}));let o=await a.z.cartItem.findFirst({where:{cartId:e.id,productId:r}});o?await a.z.cartItem.update({where:{id:o.id},data:{quantity:o.quantity+i}}):await a.z.cartItem.create({data:{cartId:e.id,productId:r,quantity:i}})}catch(e){throw console.error("Error adding to cart:",e),Error("Failed to add to cart")}}async function o(e,t){try{if(console.log("RemoveFromCart called with userId:",e,"and productId:",t),!await a.z.product.findUnique({where:{id:t}}))throw Error("Product not found");let r=await a.z.cart.findUnique({where:{userId:e}});if(!r)throw Error("Cart not found");await a.z.cartItem.deleteMany({where:{cartId:r.id,productId:t}}),console.log("Product removed successfully from cart")}catch(e){throw console.error("Error removing from cart:",e),Error("Failed to remove from cart")}}async function d(e){return(await a.z.cartItem.findMany({where:{cart:{userId:e}},include:{product:!0}})).map(e=>({id:e.id,productId:e.productId,quantity:e.quantity,price:e.product.price,product:{name:e.product.name}}))}},7582:(e,t,r)=>{"use strict";function a(e){try{localStorage.setItem("session",JSON.stringify(e))}catch(e){console.error("Error setting session:",e)}}function i(){try{let e=localStorage.getItem("session");return e?JSON.parse(e):null}catch(e){console.error("Error getting session:",e)}return null}function o(){try{localStorage.removeItem("session")}catch(e){console.error("Error clearing session:",e)}}r.d(t,{Ht:()=>i,Nq:()=>a,q7:()=>o})},6661:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(5155),i=r(7582),o=r(3411),d=r(2115);function n(){let[e,t]=(0,d.useState)(null),[r,n]=(0,d.useState)([]),[c,s]=(0,d.useState)(0);return(0,d.useEffect)(()=>{(async()=>{let e=await (0,i.Ht)();if(console.log("Session data:",e),t(e),e){let t=await (0,o.dT)(e.UserId);n(t),s(t.reduce((e,t)=>e+t.price*t.quantity,0))}})()},[]),(0,a.jsxs)("div",{className:"flex justify-center p-4 ",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md text-center w-full max-w-2xl font-bold text-2xl",children:[(0,a.jsxs)("h1",{children:["Cart of ",null==e?void 0:e.name]}),r.length>0?r.map(t=>(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[(0,a.jsxs)("p",{children:[t.product.name," - ",t.quantity," x ",t.price.toFixed(2)," zl"]}),(0,a.jsx)("button",{className:"bg-red-700 text-white px-4 py-2 rounded hover:bg-red-800 transition duration-300",onClick:async()=>{if(null==e?void 0:e.UserId){console.log("Removing item with id:",t.id),await (0,o.zY)(e.UserId,t.id);let r=await (0,o.dT)(e.UserId);n(r),s(r.reduce((e,t)=>e+t.price*t.quantity,0))}},children:"delete"})]},t.id)):(0,a.jsx)("p",{className:"mt-10",children:"No items in cart"})]}),(0,a.jsxs)("div",{className:"ml-4 h-1/4 max-w-2xl text-right bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsxs)("p",{className:"text-xl font-semibold",children:["Total Price: ",c.toFixed(2)," zÅ‚"]}),(0,a.jsx)("button",{className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300",children:"Proceed to Checkout"})]})]})}},9632:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var a=r(1094);let i=r.g.prisma||new a.PrismaClient}},e=>{var t=t=>e(e.s=t);e.O(0,[94,441,517,358],()=>t(3432)),_N_E=e.O()}]);